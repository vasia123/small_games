import{_ as L}from"./InputText.vue.d807619c.js";import{u as z}from"./useFirebaseDB.5baf7228.js";import{f as H,g as P,r as v,j as q,A as Q,B as S,$ as J,a0 as K,o as c,c as l,a as w,t as h,d as W,F as X,C as Y,b as Z,k as O,H as ee,L as V,M as I,O as B,n as se,P as ae,p as te,e as ne,_ as oe}from"./entry.0534d1ea.js";import{u as ue}from"./auth.af7fb95f.js";const re=m=>(te("data-v-bc16a672"),m=m(),ne(),m),ce={key:0},le={class:"py-5"},de={key:0,class:"grid grid-cols-2 gap-4"},ie=["onClick"],ve={key:1,class:"py-5"},me={key:1},_e=re(()=>w("p",null,"Ожидание...",-1)),ge=[_e],pe=H({__name:"index",async setup(m){let r,_;const{gamesAndQuestionsCol:N,ongoingGamesCol:T,userAnswersCol:y}=z(),f=P(),g=ue();let D;Array.isArray(f.params.gameId)?D=f.params.gameId.join(""):D=f.params.gameId;const s=v(null),o=v(null),p=v(null),d=v(null),i=v(""),A=q(T,D),b=([r,_]=Q(()=>O(A)),r=await r,_(),r);if(!b.exists())throw S({statusCode:404,statusMessage:"Игра не найдена"});const C=b.data(),F=q(N,C.gameID),k=([r,_]=Q(()=>O(F)),r=await r,_(),r);if(!k.exists())throw S({statusCode:404,statusMessage:"Игра не найдена"});const E=k.data(),M=async()=>{var u,e;const a=V(y,I("questionID","==",(u=o.value)==null?void 0:u.ID),I("userID","==",g.userId)),n=await B(a);if(n.docs.length>0){const t=n.docs[0].data().answer;((e=o.value)==null?void 0:e.guessType)==="options"?d.value=t:i.value=t}},U=async()=>{var t,G,R;const a=((t=o.value)==null?void 0:t.guessType)==="options"?d.value:i.value,n=((G=o.value)==null?void 0:G.ID)||"",u=V(y,I("questionID","==",n),I("userID","==",g.userId)),e=await B(u);if(e.docs.length>0){const x=e.docs[0];await se(x.ref,{answer:a})}else{const x={userID:g.userId,userName:g.userName,gameID:C.gameID,roundID:(R=s.value)==null?void 0:R.currentRoundIndex,correct:!1,questionID:n,answer:a,timestamp:new Date};console.log("userAnswerData",s.value),await ae(y,x)}},$=J(A,async a=>{var n,u,e;if(a.exists()){const t=a.data();(t.currentQuestionIndex!==((n=s.value)==null?void 0:n.currentQuestionIndex)||t.currentRoundIndex!==((u=s.value)==null?void 0:u.currentRoundIndex)||t.currentAnswersIndex!==((e=s.value)==null?void 0:e.currentAnswersIndex))&&(s.value&&await U(),s.value=t,console.log("newOngoingGame",t),p.value=E.rounds[s.value.currentRoundIndex],o.value=p.value.questions[s.value.currentQuestionIndex],i.value="",d.value="",await M())}});K(a=>{a(()=>{$()})});const j=a=>{d.value=a};return(a,n)=>{const u=L;return c(),l("div",null,[s.value&&s.value.status==="started"&&o.value&&p.value&&s.value.currentAnswersIndex<0?(c(),l("div",ce,[w("div",null,h(p.value.name),1),w("div",le,[W(" Вопрос: "),w("b",null,h(o.value.text),1)]),o.value.guessType==="options"?(c(),l("div",de,[(c(!0),l(X,null,Y(o.value.guessOptions,e=>(c(),l("button",{key:e,class:ee(["btn",{"btn-accent":d.value===e,"btn-primary":d.value!==e}]),onClick:t=>j(e)},h(e),11,ie))),128))])):(c(),l("div",ve,[Z(u,{modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=e=>i.value=e),type:"text",placeholder:"Введите ваш ответ"},null,8,["modelValue"])]))])):(c(),l("div",me,ge))])}}});const De=oe(pe,[["__scopeId","data-v-bc16a672"]]);export{De as default};
